{
  "openapi": "3.0.0",
  "info": {
    "title": "Tenant API",
    "version": "v2"
  },
  "servers": [
    {
      "url": "http://localhost:8081/{version}",
      "variables": {
        "version": {
          "default": ""
        }
      }
    }
  ],
  "paths": {
    "/_/tenant": {
      "post": {
        "description": "Create tenant job (create, upgrade, delete) An implementation may choose to return 204 if the job is completed by the initial operation; or it may return 201 and start the operation in the background.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "title": "Tenant job attributes",
                "description": "Configuration how to install, upgrade or delete a module for a tenant",
                "example": {
                  "value": {
                    "module_to": "mod-sample-1.3.1",
                    "module_from": "mod-sample-1.0.2",
                    "parameters": [
                      {
                        "key": "loadReference",
                        "value": "true"
                      }
                    ]
                  }
                },
                "type": "object",
                "additionalProperties": true,
                "properties": {
                  "module_from": {
                    "description": "Existing module ID. If omitted, the module is not enabled already",
                    "type": "string"
                  },
                  "module_to": {
                    "description": "Target module ID. If omitted, the existing module is disabled.",
                    "type": "string"
                  },
                  "purge": {
                    "description": "On disable should data also be purged",
                    "type": "boolean"
                  },
                  "parameters": {
                    "description": "List of key/value parameters of an error",
                    "type": "array",
                    "items": {
                      "type": "object",
                      "additionalProperties": true,
                      "properties": {
                        "key": {
                          "type": "string"
                        },
                        "value": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "Job completed"
          },
          "201": {
            "description": "Tenant job created",
            "headers": {
              "Location": {
                "description": "URI of the job",
                "required": true,
                "schema": {
                  "description": "URI of the job",
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "title": "Tenant job",
                  "description": "Tenant job information",
                  "example": {
                    "value": {
                      "id": "53bd40c8-a420-4ddb-b829-4496ff5e5be4",
                      "tenant": "diku",
                      "tenantAttributes": {
                        "module_to": "mod-sample-1.3.1",
                        "module_from": "mod-sample-1.0.2",
                        "parameters": [
                          {
                            "key": "loadReference",
                            "value": "true"
                          }
                        ]
                      },
                      "complete": true,
                      "error": "SQL error",
                      "messages": [
                        "first error",
                        "second error"
                      ]
                    }
                  },
                  "type": "object",
                  "additionalProperties": true,
                  "properties": {
                    "id": {
                      "description": "Job ID",
                      "type": "string"
                    },
                    "tenant": {
                      "description": "Tenant ID",
                      "type": "string"
                    },
                    "tenantAttributes": {
                      "title": "Tenant job attributes",
                      "description": "Configuration how to install, upgrade or delete a module for a tenant",
                      "type": "object",
                      "additionalProperties": true,
                      "properties": {
                        "module_from": {
                          "description": "Existing module ID. If omitted, the module is not enabled already",
                          "type": "string"
                        },
                        "module_to": {
                          "description": "Target module ID. If omitted, the existing module is disabled.",
                          "type": "string"
                        },
                        "purge": {
                          "description": "On disable should data also be purged",
                          "type": "boolean"
                        },
                        "parameters": {
                          "description": "List of key/value parameters of an error",
                          "type": "array",
                          "items": {
                            "type": "object",
                            "additionalProperties": true,
                            "properties": {
                              "key": {
                                "type": "string"
                              },
                              "value": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    },
                    "complete": {
                      "description": "Whether job is complete (true) or ongoing (false)",
                      "type": "boolean"
                    },
                    "error": {
                      "description": "Error message if error has occurred",
                      "type": "string"
                    },
                    "messages": {
                      "description": "Additional messages (warnings, errors)",
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad user request",
            "content": {
              "text/plain": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation errors",
            "content": {
              "application/json": {
                "schema": {
                  "description": "A set of errors",
                  "example": {
                    "strict": false,
                    "value": {
                      "errors": [
                        {
                          "message": "may not be null",
                          "type": "1",
                          "code": "-1",
                          "parameters": [
                            {
                              "key": "moduleTo",
                              "value": "null"
                            }
                          ]
                        }
                      ]
                    }
                  },
                  "type": "object",
                  "additionalProperties": true,
                  "properties": {
                    "errors": {
                      "description": "List of errors",
                      "type": "array",
                      "items": {
                        "description": "An error",
                        "type": "object",
                        "additionalProperties": true,
                        "required": [
                          "message"
                        ],
                        "properties": {
                          "message": {
                            "description": "Error message text",
                            "type": "string"
                          },
                          "type": {
                            "description": "Error message type",
                            "type": "string"
                          },
                          "code": {
                            "description": "Error message code",
                            "type": "string"
                          },
                          "parameters": {
                            "description": "List of key/value parameters of an error",
                            "type": "array",
                            "items": {
                              "type": "object",
                              "additionalProperties": true,
                              "properties": {
                                "key": {
                                  "type": "string"
                                },
                                "value": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "total_records": {
                      "description": "Total number of errors",
                      "type": "integer"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Internal error",
            "content": {
              "text/plain": {
                "schema": {
                  "example": "Internal server error"
                }
              }
            }
          }
        }
      }
    },
    "/_/tenant/{operation_id}": {
      "parameters": [
        {
          "name": "operation_id",
          "required": true,
          "in": "path",
          "schema": {
            "type": "string"
          }
        }
      ],
      "get": {
        "description": "Get tenant job",
        "parameters": [
          {
            "name": "wait",
            "description": "wait until job change, but no longer than the wait time - in milliseconds. 0 means \"no wait\" and is behavior if omitted.",
            "required": false,
            "in": "query",
            "schema": {
              "description": "wait until job change, but no longer than the wait time - in milliseconds. 0 means \"no wait\" and is behavior if omitted.",
              "default": 0,
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Tenant job returned OK",
            "content": {
              "application/json": {
                "schema": {
                  "title": "Tenant job",
                  "description": "Tenant job information",
                  "example": {
                    "value": {
                      "id": "53bd40c8-a420-4ddb-b829-4496ff5e5be4",
                      "tenant": "diku",
                      "tenantAttributes": {
                        "module_to": "mod-sample-1.3.1",
                        "module_from": "mod-sample-1.0.2",
                        "parameters": [
                          {
                            "key": "loadReference",
                            "value": "true"
                          }
                        ]
                      },
                      "complete": true,
                      "error": "SQL error",
                      "messages": [
                        "first error",
                        "second error"
                      ]
                    }
                  },
                  "type": "object",
                  "additionalProperties": true,
                  "properties": {
                    "id": {
                      "description": "Job ID",
                      "type": "string"
                    },
                    "tenant": {
                      "description": "Tenant ID",
                      "type": "string"
                    },
                    "tenantAttributes": {
                      "title": "Tenant job attributes",
                      "description": "Configuration how to install, upgrade or delete a module for a tenant",
                      "type": "object",
                      "additionalProperties": true,
                      "properties": {
                        "module_from": {
                          "description": "Existing module ID. If omitted, the module is not enabled already",
                          "type": "string"
                        },
                        "module_to": {
                          "description": "Target module ID. If omitted, the existing module is disabled.",
                          "type": "string"
                        },
                        "purge": {
                          "description": "On disable should data also be purged",
                          "type": "boolean"
                        },
                        "parameters": {
                          "description": "List of key/value parameters of an error",
                          "type": "array",
                          "items": {
                            "type": "object",
                            "additionalProperties": true,
                            "properties": {
                              "key": {
                                "type": "string"
                              },
                              "value": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    },
                    "complete": {
                      "description": "Whether job is complete (true) or ongoing (false)",
                      "type": "boolean"
                    },
                    "error": {
                      "description": "Error message if error has occurred",
                      "type": "string"
                    },
                    "messages": {
                      "description": "Additional messages (warnings, errors)",
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "User error",
            "content": {
              "text/plain": {
                "schema": {}
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "text/plain": {
                "schema": {}
              }
            }
          },
          "500": {
            "description": "Internal error",
            "content": {
              "text/plain": {
                "schema": {
                  "example": "Internal server error"
                }
              }
            }
          }
        }
      },
      "delete": {
        "description": "Delete job",
        "responses": {
          "204": {
            "description": "Job deleted ok"
          },
          "400": {
            "description": "User error",
            "content": {
              "text/plain": {
                "schema": {}
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "text/plain": {
                "schema": {}
              }
            }
          },
          "500": {
            "description": "Internal error",
            "content": {
              "text/plain": {
                "schema": {
                  "example": "Internal server error"
                }
              }
            }
          }
        }
      }
    }
  }
}
